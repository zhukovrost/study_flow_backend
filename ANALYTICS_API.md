# API Аналитики Продуктивности

Система аналитики продуктивности и риска выгорания для StudyFlow.

## Endpoints

### 1. Получить метрики продуктивности
**GET** `/api/v1/analytics/metrics?days_back=60`

Возвращает все вычисленные метрики продуктивности.

**Параметры:**
- `days_back` (int, опционально): Количество дней для анализа (по умолчанию 60)

**Ответ:**
```json
{
  "weekday_productivity": {
    "0": 5.2,
    "1": 6.1,
    ...
  },
  "top_weekdays": [
    {"weekday": 1, "mean_tasks": 6.1},
    {"weekday": 2, "mean_tasks": 5.8}
  ],
  "adj_tasks": [4.5, 5.2, ...],
  "factors": {"0": 0.95, ...},
  "moving_averages": {
    "mean_7": 5.1,
    "mean_14": 5.3,
    "mean_28": 5.0,
    "std_28": 1.2
  },
  "ema_values": [4.8, 5.0, ...],
  "z_score": 0.5,
  "burnout_risk": {
    "index": 0.35,
    "category": "средний",
    "components": {
      "downshift": 0.2,
      "momentum": 0.15,
      "zeros_rate": 0.3,
      "streak_strain": 0.4
    }
  },
  "dates": ["2024-01-01", ...],
  "tasks_raw": [5, 6, ...],
  "streaks": [1, 2, ...]
}
```

### 2. Получить полный дашборд
**GET** `/api/v1/analytics/dashboard?days_back=60`

Возвращает полный дашборд с метриками, рекомендациями и предупреждениями.

**Ответ:**
```json
{
  "metrics": { ... },
  "recommendation": {
    "message": "Ваши самые продуктивные дни: Вторник, Среда",
    "top_weekdays": ["Вторник", "Среда"],
    "suggestion": "Планируйте сложные задачи на Вторник и Среда"
  },
  "warning": {
    "category": "средний",
    "message": "Обнаружен средний риск перегрузки...",
    "suggestions": [
      "Разгрузите план на ближайшие дни",
      "Попробуйте разорвать стрик «лёгким днём»"
    ]
  }
}
```

### 3. Получить риск выгорания
**GET** `/api/v1/analytics/risk?days_back=60`

Возвращает только информацию о риске выгорания.

**Ответ:**
```json
{
  "category": "средний",
  "message": "Обнаружен средний риск перегрузки...",
  "suggestions": [...]
}
```

### 4. Получить рекомендации
**GET** `/api/v1/analytics/recommendations?days_back=60`

Возвращает только рекомендации по продуктивности.

**Ответ:**
```json
{
  "message": "Ваши самые продуктивные дни: Вторник, Среда",
  "top_weekdays": ["Вторник", "Среда"],
  "suggestion": "Планируйте сложные задачи на Вторник и Среда"
}
```

## Метрики

### Индекс риска выгорания (R_t)

Вычисляется как взвешенная сумма компонентов:
- **Downshift** (35%): Падение короткого среднего к базису
- **Momentum** (25%): Отрицательный импульс по EMA
- **ZerosRate** (25%): Доля нулевых дней в неделе
- **StreakStrain** (15%): Напряжение от длинного стрика

**Категории:**
- Низкий: R_t < 0.33
- Средний: 0.33 ≤ R_t < 0.66
- Высокий: R_t ≥ 0.66

### Нормализация сезонности

Учитывает естественные колебания продуктивности по дням недели:
- Вычисляется средняя продуктивность по каждому дню недели
- Применяется фактор нормализации для устранения сезонности
- Результат: `adj_tasks` - сезонно-очищенные значения

## Аутентификация

Все endpoints требуют аутентификации через Bearer токен в заголовке:
```
Authorization: Bearer <token>
```

